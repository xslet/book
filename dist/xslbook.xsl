<?xml version="1.0" encoding="UTF-8"?><xsl:stylesheet xmlns:ut="https://github.com/sttk/xslet/2019/xslutil" xmlns:bk="https://github.com/sttk/xslet/2019/xslbook" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0"><xsl:param xmlns:book="https://github.com/sttk/xslet/2019/xslbook" xmlns:util="https://github.com/sttk/xslet/2019/util" name="book:xsl_url"><xsl:call-template name="util:get_xsl_url"/></xsl:param><xsl:param xmlns:book="https://github.com/sttk/xslet/2019/xslbook" xmlns:util="https://github.com/sttk/xslet/2019/util" name="book:xsl_dir"><xsl:call-template name="util:get_dir_from_url"><xsl:with-param name="url" select="$book:xsl_url"/></xsl:call-template></xsl:param><xsl:param xmlns:book="https://github.com/sttk/xslet/2019/xslbook" name="book:preface_index_format"/><xsl:param xmlns:book="https://github.com/sttk/xslet/2019/xslbook" name="book:chapter_index_format">1.</xsl:param><xsl:param xmlns:book="https://github.com/sttk/xslet/2019/xslbook" name="book:appendix_index_format">A.</xsl:param><xsl:param xmlns:book="https://github.com/sttk/xslet/2019/xslbook" name="book:postface_index_format"/><xsl:param xmlns:book="https://github.com/sttk/xslet/2019/xslbook" name="book:clause_index_format">1.</xsl:param><xsl:param xmlns:book="https://github.com/sttk/xslet/2019/xslbook" name="book:section_index_format">1.</xsl:param><xsl:param xmlns:book="https://github.com/sttk/xslet/2019/xslbook" name="book:default_toc_target"><xsl:text>|preface|chapter|appendix|postface|clause|</xsl:text></xsl:param><xsl:param xmlns:book="https://github.com/sttk/xslet/2019/xslbook" name="book:default_toc_title">Table of contents</xsl:param><xsl:param xmlns:book="https://github.com/sttk/xslet/2019/xslbook" name="book:default_navi_prev">previous</xsl:param><xsl:param xmlns:book="https://github.com/sttk/xslet/2019/xslbook" name="book:default_navi_next">next</xsl:param><xsl:param xmlns:book="https://github.com/sttk/xslet/2019/xslbook" name="book:default_navi_toc">table of contents</xsl:param><xsl:param xmlns:book="https://github.com/sttk/xslet/2019/xslbook" name="book:label_of_nolink">(No link)</xsl:param><xsl:param xmlns:book="https://github.com/sttk/xslet/2019/xslbook" name="book:popup_of_nolink"><xsl:text>There is no linked element</xsl:text></xsl:param><xsl:param xmlns:book="https://github.com/sttk/xslet/2019/xslbook" name="book:toc_url"><xsl:choose><xsl:when test="contains(/xslbook/@toc, '#')"><xsl:value-of select="substring-before(/xslbook/@toc, '#')"/></xsl:when><xsl:otherwise><xsl:value-of select="/xslbook/@toc"/></xsl:otherwise></xsl:choose></xsl:param><xsl:param xmlns:book="https://github.com/sttk/xslet/2019/xslbook" name="book:page_index"><xsl:call-template name="book:get_page_index"/></xsl:param><xsl:param xmlns:book="https://github.com/sttk/xslet/2019/xslbook" name="book:page_url"><xsl:for-each select="document($book:toc_url,/)/xslbook/toc[1]"><xsl:value-of select="(.//page)[position() = $book:page_index]/@url"/></xsl:for-each></xsl:param><xsl:param xmlns:book="https://github.com/sttk/xslet/2019/xslbook" name="book:previous_page_url"><xsl:for-each select="document($book:toc_url,/)/xslbook/toc[1]"><xsl:value-of select="(.//page)[position() = $book:page_index - 1]/@url"/></xsl:for-each></xsl:param><xsl:param xmlns:book="https://github.com/sttk/xslet/2019/xslbook" name="book:next_page_url"><xsl:for-each select="document($book:toc_url,/)/xslbook/toc[1]"><xsl:value-of select="(.//page)[position() = $book:page_index + 1]/@url"/></xsl:for-each></xsl:param><xsl:param xmlns:util="https://github.com/sttk/xslet/2019/util" name="util:apos">'</xsl:param><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" xmlns:util="https://github.com/sttk/xslet/2019/util" match="/xslbook"><xsl:variable name="_data_url"><xsl:call-template name="book:get_data_url"/></xsl:variable><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta http-equiv="X-UA-Compatible" content="ie=edge"/><xsl:call-template name="book:control_window_title"><xsl:with-param name="data_url" select="$_data_url"/></xsl:call-template><xsl:call-template name="book:control_default_css_link"/><xsl:apply-templates select="css"/><xsl:call-template name="book:write_default_script_link"/><xsl:apply-templates select="script"/></head><body><header><xsl:call-template name="book:control_header"/></header><main><section class="xslbook"><xsl:call-template name="book:set_id"/><xsl:call-template name="book:control_book_title"><xsl:with-param name="data_url" select="$_data_url"/></xsl:call-template><xsl:apply-templates select="body|toc|preface|chapter|appendix|postface"><xsl:with-param name="data_url" select="$_data_url"/></xsl:apply-templates></section></main><footer><xsl:call-template name="book:control_footer"/></footer></body></html></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" xmlns:util="https://github.com/sttk/xslet/2019/util" name="book:get_data_url"><xsl:param name="data_url"/><xsl:choose><xsl:when test="boolean(@data-src)"><xsl:value-of select="@data-src"/></xsl:when><xsl:otherwise><xsl:value-of select="$data_url"/></xsl:otherwise></xsl:choose></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" xmlns:util="https://github.com/sttk/xslet/2019/util" name="book:control_window_title"><xsl:param name="data_url"/><xsl:choose><xsl:when test="boolean(/xslbook/title)"><xsl:call-template name="book:write_window_title"><xsl:with-param name="data_url" select="$data_url"/></xsl:call-template></xsl:when><xsl:when test="string-length($book:toc_url) &gt; 0"><xsl:for-each select="document($book:toc_url,/)"><xsl:call-template name="book:write_window_title"><xsl:with-param name="data_url" select="$data_url"/></xsl:call-template></xsl:for-each></xsl:when><xsl:otherwise><title/></xsl:otherwise></xsl:choose></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" xmlns:util="https://github.com/sttk/xslet/2019/util" name="book:write_window_title"><xsl:param name="data_url"/><title><xsl:apply-templates select="/xslbook/title[1]"><xsl:with-param name="data_url" select="$data_url"/></xsl:apply-templates></title></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" xmlns:util="https://github.com/sttk/xslet/2019/util" name="book:control_book_title"><xsl:param name="data_url"/><xsl:if test="boolean(/xslbook/title)"><xsl:call-template name="book:write_book_title"><xsl:with-param name="data_url" select="$data_url"/></xsl:call-template></xsl:if></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" xmlns:util="https://github.com/sttk/xslet/2019/util" name="book:write_book_title"><xsl:param name="data_url"/><h1 class="title"><span class="label"><xsl:apply-templates select="/xslbook/title[1]"><xsl:with-param name="data_url" select="$data_url"/></xsl:apply-templates></span></h1></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" xmlns:util="https://github.com/sttk/xslet/2019/util" match="/xslbook/css"><xsl:choose><xsl:when test="boolean(@url)"><link rel="stylesheet" href="{@url}"/></xsl:when><xsl:when test="boolean(@rpath)"><link rel="stylesheet" href="{concat($book:xsl_dir, '/', @rpath)}"/></xsl:when></xsl:choose></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" xmlns:util="https://github.com/sttk/xslet/2019/util" match="/xslbook/script"><xsl:choose><xsl:when test="boolean(@url)"><script src="{@url}"/></xsl:when><xsl:when test="boolean(@rpath)"><script src="{concat($book:xsl_dir, '/', @rpath)}"/></xsl:when></xsl:choose></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" xmlns:util="https://github.com/sttk/xslet/2019/util" name="book:control_default_css_link"><xsl:if test="not(boolean(css))"><link rel="stylesheet" href="{concat($book:xsl_dir, '/xslbook.css')}"/></xsl:if></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" xmlns:util="https://github.com/sttk/xslet/2019/util" name="book:write_default_script_link"><script src="{concat($book:xsl_dir, '/xslbook.js')}"/></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" xmlns:util="https://github.com/sttk/xslet/2019/util" name="book:control_header"><xsl:call-template name="book:control_navi"/></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" xmlns:util="https://github.com/sttk/xslet/2019/util" name="book:control_footer"><xsl:call-template name="book:control_navi"/></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" xmlns:util="https://github.com/sttk/xslet/2019/util" name="book:set_id"><xsl:attribute name="id"><xsl:call-template name="book:get_id"/></xsl:attribute></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" xmlns:util="https://github.com/sttk/xslet/2019/util" name="book:get_id"><xsl:choose><xsl:when test="boolean(@id)"><xsl:value-of select="@id"/></xsl:when><xsl:otherwise><xsl:text>idxbk</xsl:text><xsl:variable name="_tag_name" select="local-name()"/><xsl:value-of select="$_tag_name"/><xsl:number level="any" format="1" count="*[name() = $_tag_name]"/></xsl:otherwise></xsl:choose></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" xmlns:util="https://github.com/sttk/xslet/2019/util" match="body"><xsl:param name="data_url"/><xsl:variable name="_data_url"><xsl:call-template name="book:get_data_url"><xsl:with-param name="data_url" select="$data_url"/></xsl:call-template></xsl:variable><div class="body"><xsl:apply-templates><xsl:with-param name="data_url" select="$_data_url"/></xsl:apply-templates></div></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" xmlns:util="https://github.com/sttk/xslet/2019/util" match="dict"><xsl:param name="data_url"/><xsl:choose><xsl:when test="boolean(@type)"><xsl:call-template name="book:dict_with_style_type"><xsl:with-param name="data_url" select="$data_url"/></xsl:call-template></xsl:when><xsl:otherwise><xsl:call-template name="book:dict_with_mark"><xsl:with-param name="data_url" select="$data_url"/></xsl:call-template></xsl:otherwise></xsl:choose></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" xmlns:util="https://github.com/sttk/xslet/2019/util" name="book:dict_with_mark"><xsl:param name="data_url"/><xsl:variable name="_mark" select="@mark"/><xsl:variable name="_start"><xsl:choose><xsl:when test="boolean(@start)"><xsl:value-of select="@start"/></xsl:when><xsl:otherwise>1</xsl:otherwise></xsl:choose></xsl:variable><xsl:variable name="_sep"><xsl:choose><xsl:when test="boolean(@separator)"><xsl:value-of select="@separator"/></xsl:when></xsl:choose></xsl:variable><ul class="dict" data-mark="{$_mark}" start="{$_start}"><xsl:call-template name="book:set_id"/><xsl:apply-templates select="item"><xsl:with-param name="data_url" select="$data_url"/><xsl:with-param name="separator" select="$_sep"/><xsl:with-param name="mark" select="$_mark"/></xsl:apply-templates></ul></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" xmlns:util="https://github.com/sttk/xslet/2019/util" match="dict[not(boolean(@type))]//item"><xsl:param name="data_url"/><xsl:param name="separator"/><xsl:param name="mark"/><xsl:variable name="_index"><xsl:number level="multiple" count="item" format="{$mark}"/></xsl:variable><li class="item" data-index="{$_index}"><xsl:call-template name="book:set_id"/><xsl:apply-templates select="title|body"><xsl:with-param name="data_url" select="$data_url"/><xsl:with-param name="separator" select="$separator"/></xsl:apply-templates><xsl:if test="boolean(item)"><ul class="dict" data-mark="{$mark}" start="1"><xsl:apply-templates select="item"><xsl:with-param name="data_url" select="$data_url"/><xsl:with-param name="separator" select="$separator"/><xsl:with-param name="mark" select="$mark"/></xsl:apply-templates></ul></xsl:if></li></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" xmlns:util="https://github.com/sttk/xslet/2019/util" name="book:dict_with_style_type"><xsl:param name="data_url"/><xsl:variable name="_type"><xsl:choose><xsl:when test="not(substring(@type, 1, 1) = $util:apos and substring(@type, string-length(@type), 1) = $util:apos)"><xsl:call-template name="util:validate_string"><xsl:with-param name="value" select="normalize-space(@type)"/><xsl:with-param name="forbidden" select="'; '"/><xsl:with-param name="default" select="'disc'"/></xsl:call-template></xsl:when><xsl:otherwise><xsl:value-of select="@type"/></xsl:otherwise></xsl:choose></xsl:variable><xsl:variable name="_sep"><xsl:choose><xsl:when test="boolean(@separator)"><xsl:value-of select="@separator"/></xsl:when></xsl:choose></xsl:variable><ul class="dict" style="list-style-type:{$_type};"><xsl:call-template name="book:set_id"/><xsl:if test="boolean(@start)"><xsl:attribute name="start"><xsl:value-of select="@start"/></xsl:attribute></xsl:if><xsl:if test="boolean(@reversed)"><xsl:attribute name="reversed"><xsl:value-of select="@reversed"/></xsl:attribute></xsl:if><xsl:apply-templates select="item"><xsl:with-param name="data_url" select="$data_url"/><xsl:with-param name="separator" select="$_sep"/><xsl:with-param name="type" select="$_type"/></xsl:apply-templates></ul></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" xmlns:util="https://github.com/sttk/xslet/2019/util" match="dict[boolean(@type)]//item"><xsl:param name="data_url"/><xsl:param name="separator"/><xsl:param name="type"/><li class="item"><xsl:call-template name="book:set_id"/><xsl:apply-templates select="title|body"><xsl:with-param name="data_url" select="$data_url"/><xsl:with-param name="separator" select="$separator"/></xsl:apply-templates><xsl:if test="boolean(item)"><ul class="dict" style="list-style-type:{$type};"><xsl:apply-templates select="item"><xsl:with-param name="data_url" select="$data_url"/><xsl:with-param name="separator" select="$separator"/><xsl:with-param name="type" select="$type"/></xsl:apply-templates></ul></xsl:if></li></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" xmlns:util="https://github.com/sttk/xslet/2019/util" match="dict//item/title[1]"><xsl:param name="data_url"/><xsl:param name="separator"/><span class="title"><xsl:attribute name="data-separator"><xsl:value-of select="$separator"/></xsl:attribute><xsl:apply-templates><xsl:with-param name="data_url" select="$data_url"/></xsl:apply-templates></span></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" xmlns:util="https://github.com/sttk/xslet/2019/util" match="dict//item/body"><xsl:param name="data_url"/><div class="body"><xsl:apply-templates><xsl:with-param name="data_url" select="$data_url"/></xsl:apply-templates></div></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" match="p|br|b|i|u|sup|sub|hr|code"><xsl:param name="data_url"/><xsl:variable name="_data_url"><xsl:call-template name="book:get_data_url"><xsl:with-param name="data_url" select="$data_url"/></xsl:call-template></xsl:variable><xsl:element name="{name()}"><xsl:for-each select="attribute::*"><xsl:attribute name="{name()}"><xsl:value-of select="."/></xsl:attribute></xsl:for-each><xsl:apply-templates><xsl:with-param name="data_url" select="$_data_url"/></xsl:apply-templates></xsl:element></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" match="bar"><span class="bar">──</span></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" match="dots"><span class="dots">････</span></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" match="link"><xsl:param name="data_url"/><xsl:variable name="_data_url"><xsl:call-template name="book:get_data_url"><xsl:with-param name="data_url" select="$data_url"/></xsl:call-template></xsl:variable><xsl:variable name="_label"><xsl:apply-templates><xsl:with-param name="data_url" select="$_data_url"/></xsl:apply-templates></xsl:variable><xsl:variable name="_only" select="@only"/><xsl:choose><xsl:when test="boolean(@url)"><xsl:call-template name="book:write_link_by_url"><xsl:with-param name="url" select="@url"/><xsl:with-param name="label" select="$_label"/></xsl:call-template></xsl:when><xsl:when test="boolean(@refid)"><xsl:variable name="_refid" select="@refid"/><xsl:choose><xsl:when test="boolean(@page)"><xsl:variable name="_page" select="@page"/><xsl:for-each select="document($_page, /)"><xsl:call-template name="book:control_link_by_refid_in_this_page"><xsl:with-param name="data_url" select="$_data_url"/><xsl:with-param name="refid" select="$_refid"/><xsl:with-param name="label" select="$_label"/><xsl:with-param name="only" select="$_only"/><xsl:with-param name="page" select="$_page"/></xsl:call-template></xsl:for-each></xsl:when><xsl:when test="string-length($book:toc_url) &gt; 0"><xsl:for-each select="document($book:toc_url, /)"><xsl:call-template name="book:control_link_by_refid_in_toc_page"><xsl:with-param name="data_url" select="$_data_url"/><xsl:with-param name="refid" select="$_refid"/><xsl:with-param name="label" select="$_label"/><xsl:with-param name="only" select="$_only"/></xsl:call-template></xsl:for-each></xsl:when><xsl:otherwise><xsl:call-template name="book:control_link_by_refid_in_this_page"><xsl:with-param name="data_url" select="$_data_url"/><xsl:with-param name="refid" select="$_refid"/><xsl:with-param name="label" select="$_label"/><xsl:with-param name="only" select="$_only"/></xsl:call-template></xsl:otherwise></xsl:choose></xsl:when><xsl:otherwise><xsl:call-template name="book:write_nolink"><xsl:with-param name="refid" select="@refid"/><xsl:with-param name="label" select="$_label"/></xsl:call-template></xsl:otherwise></xsl:choose></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" name="book:control_link_by_refid_in_this_page"><xsl:param name="data_url"/><xsl:param name="refid"/><xsl:param name="label"/><xsl:param name="only"/><xsl:param name="page"/><xsl:param name="page_index"/><xsl:choose><xsl:when test="boolean(//*[@id = $refid])"><xsl:choose><xsl:when test="string-length($label) &gt; 0"><xsl:call-template name="book:write_link_by_refid"><xsl:with-param name="refid" select="$refid"/><xsl:with-param name="label" select="$label"/><xsl:with-param name="page" select="$page"/></xsl:call-template></xsl:when><xsl:otherwise><xsl:for-each select="(//*[@id = $refid])[1]"><xsl:variable name="_chapter_type"><xsl:call-template name="book:get_chapter_type"/></xsl:variable><xsl:variable name="_index"><xsl:if test="not($only = 'label')"><xsl:variable name="_element_name" select="name()"/><xsl:call-template name="book:get_element_index"><xsl:with-param name="data_url" select="$data_url"/><xsl:with-param name="chapter_type" select="$_chapter_type"/><xsl:with-param name="element_name" select="$_element_name"/><xsl:with-param name="page_index" select="$page_index"/></xsl:call-template></xsl:if></xsl:variable><xsl:variable name="_label"><xsl:if test="not($only = 'index')"><xsl:apply-templates select="title"><xsl:with-param name="data_url" select="$data_url"/></xsl:apply-templates></xsl:if></xsl:variable><xsl:call-template name="book:write_title_link_by_refid"><xsl:with-param name="refid" select="$refid"/><xsl:with-param name="index" select="$_index"/><xsl:with-param name="label" select="$_label"/><xsl:with-param name="page" select="$page"/><xsl:with-param name="chapter_type" select="$_chapter_type"/></xsl:call-template></xsl:for-each></xsl:otherwise></xsl:choose></xsl:when><xsl:otherwise><xsl:call-template name="book:write_nolink"><xsl:with-param name="refid" select="$refid"/><xsl:with-param name="label" select="$label"/></xsl:call-template></xsl:otherwise></xsl:choose></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" name="book:get_element_index"><xsl:param name="data_url"/><xsl:param name="element_name"/><xsl:param name="chapter_type"/><xsl:param name="page_index"/><xsl:choose><xsl:when test="contains('preface chapter appendix postface', $element_name)"><xsl:call-template name="book:get_chapter_index"><xsl:with-param name="data_url" select="$data_url"/><xsl:with-param name="chapter_type" select="$chapter_type"/><xsl:with-param name="page_index" select="$page_index"/></xsl:call-template></xsl:when><xsl:when test="$element_name = 'xslbook'"/><xsl:otherwise><xsl:call-template name="book:get_chapter_index"><xsl:with-param name="data_url" select="$data_url"/><xsl:with-param name="chapter_type" select="$chapter_type"/><xsl:with-param name="page_index" select="$page_index"/></xsl:call-template><xsl:number level="multiple" count="clause|section" format="{$book:clause_index_format}{$book:section_index_format}"/></xsl:otherwise></xsl:choose></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" name="book:control_link_by_refid_in_toc_page"><xsl:param name="data_url"/><xsl:param name="refid"/><xsl:param name="label"/><xsl:param name="only"/><xsl:variable name="_page" select="/xslbook/toc//page[document(@url,/)//*[@id=$refid]]/@url"/><xsl:variable name="_page_index"><xsl:for-each select="/xslbook/toc//page"><xsl:if test="@url = $_page"><xsl:value-of select="position()"/></xsl:if></xsl:for-each></xsl:variable><xsl:choose><xsl:when test="string-length($_page) &gt; 0"><xsl:for-each select="document($_page,/)"><xsl:call-template name="book:control_link_by_refid_in_this_page"><xsl:with-param name="data_url" select="$data_url"/><xsl:with-param name="refid" select="$refid"/><xsl:with-param name="label" select="$label"/><xsl:with-param name="only" select="$only"/><xsl:with-param name="page" select="$_page"/><xsl:with-param name="page_index" select="$_page_index"/></xsl:call-template></xsl:for-each></xsl:when><xsl:otherwise><xsl:call-template name="book:write_nolink"><xsl:with-param name="refid" select="$refid"/><xsl:with-param name="label" select="$label"/></xsl:call-template></xsl:otherwise></xsl:choose></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" name="book:write_title_link_by_refid"><xsl:param name="refid"/><xsl:param name="index"/><xsl:param name="label"/><xsl:param name="page"/><xsl:param name="chapter_type"/><a class="link title" href="{concat($page,'#',$refid)}"><xsl:if test="string-length($index) &gt; 0"><span class="index index-in-{$chapter_type}"><xsl:value-of select="$index"/></span></xsl:if><xsl:if test="string-length($label) &gt; 0"><span class="label"><xsl:value-of select="$label"/></span></xsl:if></a></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" name="book:write_link_by_refid"><xsl:param name="page"/><xsl:param name="refid"/><xsl:param name="label"/><a class="link" href="{concat($page,'#',$refid)}"><xsl:value-of select="$label"/></a></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" name="book:write_link_by_url"><xsl:param name="url"/><xsl:param name="label"/><a class="link" href="{$url}"><xsl:choose><xsl:when test="string-length($label) &gt; 0"><xsl:value-of select="$label"/></xsl:when><xsl:otherwise><xsl:value-of select="$url"/></xsl:otherwise></xsl:choose></a></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" name="book:write_nolink"><xsl:param name="refid"/><xsl:param name="label"/><xsl:choose><xsl:when test="string-length($label) &gt; 0"><span class="nolink" title="{concat($book:popup_of_nolink,': ',$refid)}"><xsl:value-of select="$label"/></span></xsl:when><xsl:otherwise><span class="nolink" title="{concat($book:popup_of_nolink,': ',$refid)}"><xsl:value-of select="$book:label_of_nolink"/></span></xsl:otherwise></xsl:choose></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" name="book:get_chapter_type"><xsl:value-of select="name(ancestor-or-self::*[contains('preface chapter appendix postface',name())])"/></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" xmlns:util="https://github.com/sttk/xslet/2019/util" match="list"><xsl:param name="data_url"/><xsl:choose><xsl:when test="boolean(@type)"><xsl:call-template name="book:list_with_style_type"><xsl:with-param name="data_url" select="$data_url"/></xsl:call-template></xsl:when><xsl:otherwise><xsl:call-template name="book:list_with_mark"><xsl:with-param name="data_url" select="$data_url"/></xsl:call-template></xsl:otherwise></xsl:choose></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" xmlns:util="https://github.com/sttk/xslet/2019/util" name="book:list_with_mark"><xsl:param name="data_url"/><xsl:variable name="_mark" select="@mark"/><xsl:variable name="_start"><xsl:choose><xsl:when test="boolean(@start)"><xsl:value-of select="@start"/></xsl:when><xsl:otherwise>1</xsl:otherwise></xsl:choose></xsl:variable><xsl:variable name="_sep"><xsl:choose><xsl:when test="boolean(@separator)"><xsl:value-of select="@separator"/></xsl:when><xsl:otherwise>:</xsl:otherwise></xsl:choose></xsl:variable><ul class="list" data-mark="{$_mark}" start="{$_start}"><xsl:call-template name="book:set_id"/><xsl:for-each select="item"><xsl:variable name="_index"><xsl:number count="item" format="{$_mark}"/></xsl:variable><li class="item" data-index="{$_index}"><xsl:call-template name="book:set_id"/><xsl:apply-templates><xsl:with-param name="data_url" select="$data_url"/><xsl:with-param name="separator" select="$_sep"/></xsl:apply-templates></li></xsl:for-each></ul></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" xmlns:util="https://github.com/sttk/xslet/2019/util" name="book:list_with_style_type"><xsl:param name="data_url"/><xsl:variable name="_type"><xsl:choose><xsl:when test="not(substring(@type, 1, 1) = $util:apos and substring(@type, string-length(@type), 1) = $util:apos)"><xsl:call-template name="util:validate_string"><xsl:with-param name="value" select="normalize-space(@type)"/><xsl:with-param name="forbidden" select="'; '"/><xsl:with-param name="default" select="'disc'"/></xsl:call-template></xsl:when><xsl:otherwise><xsl:value-of select="@type"/></xsl:otherwise></xsl:choose></xsl:variable><xsl:variable name="_sep"><xsl:choose><xsl:when test="boolean(@separator)"><xsl:value-of select="@separator"/></xsl:when><xsl:otherwise>:</xsl:otherwise></xsl:choose></xsl:variable><ul class="list" style="list-style-type:{$_type};"><xsl:call-template name="book:set_id"/><xsl:if test="boolean(@start)"><xsl:attribute name="start"><xsl:value-of select="@start"/></xsl:attribute></xsl:if><xsl:if test="boolean(@reversed)"><xsl:attribute name="reversed"><xsl:value-of select="@reversed"/></xsl:attribute></xsl:if><xsl:for-each select="item"><li class="item"><xsl:call-template name="book:set_id"/><xsl:apply-templates><xsl:with-param name="data_url" select="$data_url"/><xsl:with-param name="separator" select="$_sep"/></xsl:apply-templates></li></xsl:for-each></ul></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" xmlns:util="https://github.com/sttk/xslet/2019/util" match="list/item/title[1]"><xsl:param name="data_url"/><span class="title"><xsl:apply-templates><xsl:with-param name="data_url" select="$data_url"/></xsl:apply-templates></span></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" xmlns:util="https://github.com/sttk/xslet/2019/util" match="list/item/body[1]"><xsl:param name="data_url"/><xsl:param name="separator"/><span class="body"><xsl:attribute name="data-separator"><xsl:value-of select="$separator"/></xsl:attribute><xsl:apply-templates><xsl:with-param name="data_url" select="$data_url"/></xsl:apply-templates></span></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" name="book:get_page_index"><xsl:if test="string-length($book:toc_url) &gt; 0"><xsl:variable name="_index"><xsl:choose><xsl:when test="system-property('xsl:vendor') = 'Transformiix'"><xsl:call-template name="book:_get_page_index_by_gid"/></xsl:when></xsl:choose></xsl:variable><xsl:choose><xsl:when test="string-length($_index) &gt; 0"><xsl:value-of select="$_index"/></xsl:when><xsl:otherwise><xsl:call-template name="book:_get_page_index_by_titles"/></xsl:otherwise></xsl:choose></xsl:if></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" name="book:_get_page_index_by_gid"><xsl:variable name="_this_gid" select="generate-id(/)"/><xsl:for-each select="document($book:toc_url,/)/xslbook/toc[1]"><xsl:for-each select=".//page"><xsl:if test="generate-id(document(@url,/)) = $_this_gid"><xsl:value-of select="position()"/></xsl:if></xsl:for-each></xsl:for-each></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" name="book:_get_page_index_by_titles"><xsl:variable name="_this_titles"><xsl:apply-templates select="//title"/></xsl:variable><xsl:for-each select="document($book:toc_url,/)/xslbook/toc[1]"><xsl:for-each select=".//page"><xsl:variable name="_titles"><xsl:apply-templates select="document(@url,/)//title"/></xsl:variable><xsl:if test="$_titles = $_this_titles"><xsl:value-of select="position()"/></xsl:if></xsl:for-each></xsl:for-each></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" name="book:control_navi"><xsl:if test="string-length($book:toc_url) &gt; 0"><xsl:call-template name="book:write_navi"/></xsl:if></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" name="book:write_navi"><nav class="navi"><xsl:call-template name="book:write_navi_previous"/><xsl:call-template name="book:write_navi_next"/><xsl:call-template name="book:write_navi_toc"/></nav></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" name="book:write_navi_previous"><span class="navi-page navi-previous"><xsl:choose><xsl:when test="string-length($book:previous_page_url) = 0"><a class="disabled"><xsl:value-of select="$book:default_navi_prev"/></a></xsl:when><xsl:otherwise><a href="{$book:previous_page_url}"><xsl:value-of select="$book:default_navi_prev"/></a></xsl:otherwise></xsl:choose></span></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" name="book:write_navi_next"><span class="navi-page navi-next"><xsl:choose><xsl:when test="string-length($book:next_page_url) = 0"><a class="disabled"><xsl:value-of select="$book:default_navi_next"/></a></xsl:when><xsl:otherwise><a href="{$book:next_page_url}"><xsl:value-of select="$book:default_navi_next"/></a></xsl:otherwise></xsl:choose></span></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" name="book:write_navi_toc"><span class="navi-page navi-toc"><a href="{$book:toc_url}"><xsl:value-of select="$book:default_navi_toc"/></a></span></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" name="book:count_until_prev_page"><xsl:param name="chapter_type"/><xsl:param name="page_index" select="$book:page_index"/><xsl:choose><xsl:when test="string-length($book:toc_url) &gt; 0"><xsl:for-each select="document($book:toc_url,/)/xslbook/toc[1]"><xsl:value-of select="count(document((.//page)[position() &lt; $page_index]/@url, /)/xslbook/*[name() = $chapter_type])"/></xsl:for-each></xsl:when><xsl:otherwise><xsl:value-of select="0"/></xsl:otherwise></xsl:choose></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" xmlns:util="https://github.com/sttk/xslet/2019/util" match="quote"><xsl:param name="data_url"/><blockquote><div class="quote-content"><xsl:apply-templates select="body"><xsl:with-param name="data_url" select="$data_url"/></xsl:apply-templates></div><xsl:if test="boolean(source)"><div class="quote-source"><span class="quote-source"><xsl:apply-templates select="source"/></span></div></xsl:if></blockquote></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" match="preface|chapter|appendix|postface"><xsl:param name="data_url"/><xsl:variable name="_data_url"><xsl:call-template name="book:get_data_url"><xsl:with-param name="data_url" select="$data_url"/></xsl:call-template></xsl:variable><xsl:variable name="_chapter_type" select="name()"/><xsl:variable name="_chapter_index"><xsl:call-template name="book:get_chapter_index"><xsl:with-param name="data_url" select="$_data_url"/><xsl:with-param name="chapter_type" select="$_chapter_type"/></xsl:call-template></xsl:variable><section class="{$_chapter_type}"><xsl:call-template name="book:set_id"/><xsl:call-template name="book:write_chapter_title"><xsl:with-param name="data_url" select="$_data_url"/><xsl:with-param name="chapter_type" select="$_chapter_type"/><xsl:with-param name="chapter_index" select="$_chapter_index"/></xsl:call-template><xsl:apply-templates select="body|toc|clause"><xsl:with-param name="data_url" select="$_data_url"/><xsl:with-param name="chapter_type" select="$_chapter_type"/><xsl:with-param name="chapter_index" select="$_chapter_index"/></xsl:apply-templates></section></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" name="book:get_chapter_index"><xsl:param name="data_url"/><xsl:param name="chapter_type"/><xsl:param name="page_index" select="$book:page_index"/><xsl:choose><xsl:when test="$chapter_type = 'preface'"><xsl:if test="string-length($book:preface_index_format) &gt; 0"><xsl:call-template name="book:format_chapter_index"><xsl:with-param name="index_format" select="$book:preface_index_format"/><xsl:with-param name="index_in_page"><xsl:number level="multiple" format="1" count="preface"/></xsl:with-param><xsl:with-param name="count_until_prev_page"><xsl:call-template name="book:count_until_prev_page"><xsl:with-param name="chapter_type" select="$chapter_type"/><xsl:with-param name="page_index" select="$page_index"/></xsl:call-template></xsl:with-param></xsl:call-template></xsl:if></xsl:when><xsl:when test="$chapter_type = 'postface'"><xsl:if test="string-length($book:postface_index_format) &gt; 0"><xsl:call-template name="book:format_chapter_index"><xsl:with-param name="index_format" select="$book:postface_index_format"/><xsl:with-param name="index_in_page"><xsl:number level="multiple" format="1" count="postface"/></xsl:with-param><xsl:with-param name="count_until_prev_page"><xsl:call-template name="book:count_until_prev_page"><xsl:with-param name="chapter_type" select="$chapter_type"/><xsl:with-param name="page_index" select="$page_index"/></xsl:call-template></xsl:with-param></xsl:call-template></xsl:if></xsl:when><xsl:when test="$chapter_type = 'appendix'"><xsl:if test="string-length($book:appendix_index_format) &gt; 0"><xsl:call-template name="book:format_chapter_index"><xsl:with-param name="index_format" select="$book:appendix_index_format"/><xsl:with-param name="index_in_page"><xsl:number level="multiple" format="1" count="appendix"/></xsl:with-param><xsl:with-param name="count_until_prev_page"><xsl:call-template name="book:count_until_prev_page"><xsl:with-param name="chapter_type" select="$chapter_type"/><xsl:with-param name="page_index" select="$page_index"/></xsl:call-template></xsl:with-param></xsl:call-template></xsl:if></xsl:when><xsl:otherwise><xsl:if test="string-length($book:chapter_index_format) &gt; 0"><xsl:call-template name="book:format_chapter_index"><xsl:with-param name="index_format" select="$book:chapter_index_format"/><xsl:with-param name="index_in_page"><xsl:number level="multiple" format="1" count="chapter"/></xsl:with-param><xsl:with-param name="count_until_prev_page"><xsl:call-template name="book:count_until_prev_page"><xsl:with-param name="chapter_type" select="$chapter_type"/><xsl:with-param name="page_index" select="$page_index"/></xsl:call-template></xsl:with-param></xsl:call-template></xsl:if></xsl:otherwise></xsl:choose></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" name="book:format_chapter_index"><xsl:param name="count_until_prev_page" select="'0'"/><xsl:param name="index_in_page"/><xsl:param name="index_format"/><xsl:variable name="_n" select="$count_until_prev_page + $index_in_page"/><xsl:number format="{$index_format}" value="$_n"/></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" name="book:write_chapter_title"><xsl:param name="data_url"/><xsl:param name="chapter_type"/><xsl:param name="chapter_index"/><h2 class="title"><span class="index index-in-{$chapter_type}"><xsl:value-of select="$chapter_index"/></span><span class="label"><xsl:apply-templates select="title"><xsl:with-param name="data_url" select="$data_url"/></xsl:apply-templates></span></h2></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" match="clause"><xsl:param name="data_url"/><xsl:param name="chapter_type"/><xsl:param name="chapter_index"/><xsl:variable name="_data_url"><xsl:call-template name="book:get_data_url"><xsl:with-param name="data_url" select="$data_url"/></xsl:call-template></xsl:variable><section class="clause"><xsl:call-template name="book:set_id"/><xsl:call-template name="book:write_clause_title"><xsl:with-param name="data_url" select="$_data_url"/><xsl:with-param name="chapter_type" select="$chapter_type"/><xsl:with-param name="chapter_index" select="$chapter_index"/></xsl:call-template><xsl:apply-templates select="body|toc|section"><xsl:with-param name="data_url" select="$_data_url"/><xsl:with-param name="chapter_type" select="$chapter_type"/><xsl:with-param name="chapter_index" select="$chapter_index"/></xsl:apply-templates></section></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" name="book:write_clause_title"><xsl:param name="data_url"/><xsl:param name="chapter_type"/><xsl:param name="chapter_index"/><h3 class="title"><span class="index index-in-{$chapter_type}"><xsl:value-of select="$chapter_index"/><xsl:if test="string-length($chapter_index) &gt; 0"><xsl:number level="multiple" count="clause" format="{$book:clause_index_format}"/></xsl:if></span><span class="label"><xsl:apply-templates select="title"><xsl:with-param name="data_url" select="$data_url"/></xsl:apply-templates></span></h3></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" match="section"><xsl:param name="data_url"/><xsl:param name="chapter_type"/><xsl:param name="chapter_index"/><xsl:variable name="_data_url"><xsl:call-template name="book:get_data_url"><xsl:with-param name="data_url" select="$data_url"/></xsl:call-template></xsl:variable><section class="section"><xsl:call-template name="book:set_id"/><xsl:call-template name="book:write_section_title"><xsl:with-param name="data_url" select="$_data_url"/><xsl:with-param name="chapter_type" select="$chapter_type"/><xsl:with-param name="chapter_index" select="$chapter_index"/></xsl:call-template><xsl:apply-templates select="body|toc|section"><xsl:with-param name="data_url" select="$_data_url"/><xsl:with-param name="chapter_type" select="$chapter_type"/><xsl:with-param name="chapter_index" select="$chapter_index"/></xsl:apply-templates></section></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" name="book:write_section_title"><xsl:param name="data_url"/><xsl:param name="chapter_type"/><xsl:param name="chapter_index"/><h4 class="title"><span class="index index-in-{$chapter_type}"><xsl:value-of select="$chapter_index"/><xsl:if test="string-length($chapter_index) &gt; 0"><xsl:number level="multiple" count="clause|section" format="{$book:clause_index_format}{$book:section_index_format}"/></xsl:if></span><span class="label"><xsl:apply-templates select="title"><xsl:with-param name="data_url" select="$data_url"/></xsl:apply-templates></span></h4></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" match="toc"><xsl:param name="data_url"/><xsl:param name="chapter_type"/><xsl:param name="chapter_index"/><xsl:variable name="_data_url"><xsl:call-template name="book:get_data_url"><xsl:with-param name="data_url" select="$data_url"/></xsl:call-template></xsl:variable><xsl:variable name="_toc_target"><xsl:call-template name="book:get_toc_target"><xsl:with-param name="default_target" select="$book:default_toc_target"/></xsl:call-template></xsl:variable><xsl:variable name="_is_toc_page"><xsl:if test="string-length($book:toc_url) &gt; 0"><xsl:if test="boolean(.//page)"><xsl:value-of select="generate-id(document($book:page_url,/)) = generate-id(document($book:toc_url,/))"/></xsl:if></xsl:if></xsl:variable><nav class="toc"><xsl:call-template name="book:set_id"/><xsl:call-template name="book:write_toc_title"><xsl:with-param name="data_url" select="$data_url"/></xsl:call-template><div class="body"><xsl:choose><xsl:when test="$_is_toc_page = 'true'"><xsl:call-template name="book:control_toc_in_page_or_part"><xsl:with-param name="data_url" select="$_data_url"/><xsl:with-param name="toc_target" select="$_toc_target"/><xsl:with-param name="chapter_type" select="$chapter_type"/><xsl:with-param name="chapter_index" select="$chapter_index"/></xsl:call-template></xsl:when><xsl:otherwise><xsl:for-each select=".."><xsl:call-template name="book:control_toc_in_page"><xsl:with-param name="data_url" select="$_data_url"/><xsl:with-param name="toc_target" select="$_toc_target"/><xsl:with-param name="chapter_type" select="$chapter_type"/><xsl:with-param name="chapter_index" select="$chapter_index"/></xsl:call-template></xsl:for-each></xsl:otherwise></xsl:choose></div></nav></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" name="book:write_toc_of_part"><xsl:param name="data_url"/><h3 class="title"><xsl:apply-templates select="title"><xsl:with-param name="data_url" select="$data_url"/></xsl:apply-templates></h3></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" name="book:control_toc_in_page_or_part"><xsl:param name="data_url"/><xsl:param name="toc_target"/><xsl:param name="chapter_type"/><xsl:param name="chapter_index"/><xsl:for-each select="part|page"><xsl:variable name="_gid" select="generate-id()"/><xsl:choose><xsl:when test="name() = 'part'"><div class="toc-part"><xsl:call-template name="book:write_toc_of_part"><xsl:with-param name="data_url" select="$data_url"/></xsl:call-template><xsl:call-template name="book:control_toc_in_page_or_part"><xsl:with-param name="data_url" select="$data_url"/><xsl:with-param name="toc_target" select="$toc_target"/><xsl:with-param name="chapter_type" select="$chapter_type"/><xsl:with-param name="chapter_index" select="$chapter_index"/></xsl:call-template></div></xsl:when><xsl:otherwise><xsl:variable name="_page_index" select="count(//*[generate-id() = $_gid]/preceding::page) +1"/><xsl:variable name="_page_url" select="@url"/><xsl:for-each select="document(@url,/)/xslbook"><xsl:call-template name="book:control_toc_in_page"><xsl:with-param name="data_url" select="$data_url"/><xsl:with-param name="toc_target" select="$toc_target"/><xsl:with-param name="chapter_type" select="$chapter_type"/><xsl:with-param name="chapter_index" select="$chapter_index"/><xsl:with-param name="page_index" select="$_page_index"/><xsl:with-param name="page_url" select="$_page_url"/></xsl:call-template></xsl:for-each></xsl:otherwise></xsl:choose></xsl:for-each></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" name="book:control_toc_in_page"><xsl:param name="data_url"/><xsl:param name="toc_target"/><xsl:param name="chapter_type"/><xsl:param name="chapter_index"/><xsl:param name="page_index" select="$book:page_index"/><xsl:param name="page_url" select="$book:page_url"/><xsl:choose><xsl:when test="name() = 'xslbook'"><xsl:call-template name="book:control_toc_of_chapter"><xsl:with-param name="data_url" select="$data_url"/><xsl:with-param name="toc_target" select="$toc_target"/><xsl:with-param name="page_index" select="$page_index"/><xsl:with-param name="page_url" select="$page_url"/></xsl:call-template></xsl:when><xsl:when test="name(..) = 'xslbook'"><xsl:call-template name="book:control_toc_of_clause"><xsl:with-param name="data_url" select="$data_url"/><xsl:with-param name="toc_target" select="$toc_target"/><xsl:with-param name="chapter_type" select="$chapter_type"/><xsl:with-param name="chapter_index" select="$chapter_index"/><xsl:with-param name="page_url" select="$page_url"/></xsl:call-template></xsl:when><xsl:when test="name() = 'clause' or name() = 'section'"><xsl:call-template name="book:control_toc_of_section"><xsl:with-param name="data_url" select="$data_url"/><xsl:with-param name="toc_target" select="$toc_target"/><xsl:with-param name="chapter_type" select="$chapter_type"/><xsl:with-param name="chapter_index" select="$chapter_index"/><xsl:with-param name="page_url" select="$page_url"/></xsl:call-template></xsl:when></xsl:choose></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" name="book:get_toc_target"><xsl:param name="default_target"/><xsl:choose><xsl:when test="string-length(@target) &gt; 0"><xsl:value-of select="concat('|', @target, '|')"/></xsl:when><xsl:otherwise><xsl:value-of select="$default_target"/></xsl:otherwise></xsl:choose></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" name="book:write_toc_title"><xsl:param name="data_url"/><xsl:choose><xsl:when test="boolean(title)"><h2 class="title"><xsl:apply-templates select="title"><xsl:with-param name="data_url" select="$data_url"/></xsl:apply-templates></h2></xsl:when><xsl:otherwise><h2 class="title"><xsl:value-of select="$book:default_toc_title"/></h2></xsl:otherwise></xsl:choose></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" name="book:write_toc_of_chapter"><xsl:param name="data_url"/><xsl:param name="page_url"/><xsl:param name="chapter_id"/><xsl:param name="chapter_type"/><xsl:param name="chapter_index"/><a class="title"><xsl:attribute name="href"><xsl:value-of select="concat($page_url, '#', $chapter_id)"/></xsl:attribute><span class="index index-in-{$chapter_type}"><xsl:value-of select="$chapter_index"/></span><span class="label"><xsl:apply-templates select="title"><xsl:with-param name="data_url" select="$data_url"/></xsl:apply-templates></span></a></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" name="book:control_toc_of_chapter"><xsl:param name="data_url"/><xsl:param name="toc_target"/><xsl:param name="page_index"/><xsl:param name="page_url"/><xsl:for-each select="preface|chapter|appendix|postface"><xsl:variable name="_chapter_id"><xsl:call-template name="book:get_id"/></xsl:variable><xsl:variable name="_chapter_type" select="name()"/><xsl:variable name="_chapter_index"><xsl:call-template name="book:get_chapter_index"><xsl:with-param name="data_url" select="$data_url"/><xsl:with-param name="chapter_type" select="$_chapter_type"/><xsl:with-param name="page_index" select="$page_index"/></xsl:call-template></xsl:variable><xsl:choose><xsl:when test="contains($toc_target, concat('|',$_chapter_type,'|'))"><div class="toc-{$_chapter_type}"><xsl:call-template name="book:write_toc_of_chapter"><xsl:with-param name="data_url" select="$data_url"/><xsl:with-param name="page_url" select="$page_url"/><xsl:with-param name="chapter_id" select="$_chapter_id"/><xsl:with-param name="chapter_type" select="$_chapter_type"/><xsl:with-param name="chapter_index" select="$_chapter_index"/></xsl:call-template><xsl:call-template name="book:control_toc_of_clause"><xsl:with-param name="data_url" select="$data_url"/><xsl:with-param name="toc_target" select="$toc_target"/><xsl:with-param name="chapter_type" select="$_chapter_type"/><xsl:with-param name="chapter_index" select="$_chapter_index"/><xsl:with-param name="page_url" select="$page_url"/></xsl:call-template></div></xsl:when><xsl:when test="contains($toc_target, concat('|~',$_chapter_type,'|'))"><xsl:call-template name="book:control_toc_of_clause"><xsl:with-param name="data_url" select="$data_url"/><xsl:with-param name="toc_target" select="$toc_target"/><xsl:with-param name="chapter_type" select="$_chapter_type"/><xsl:with-param name="chapter_index" select="$_chapter_index"/><xsl:with-param name="page_url" select="$page_url"/></xsl:call-template></xsl:when></xsl:choose></xsl:for-each></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" name="book:write_toc_of_clause"><xsl:param name="data_url"/><xsl:param name="page_url"/><xsl:param name="chapter_type"/><xsl:param name="clause_id"/><xsl:param name="clause_index"/><a class="title"><xsl:attribute name="href"><xsl:value-of select="concat($page_url, '#', $clause_id)"/></xsl:attribute><span class="index index-in-{$chapter_type}"><xsl:value-of select="$clause_index"/></span><span class="label"><xsl:apply-templates select="title"><xsl:with-param name="data_url" select="$data_url"/></xsl:apply-templates></span></a></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" name="book:control_toc_of_clause"><xsl:param name="data_url"/><xsl:param name="toc_target"/><xsl:param name="chapter_type"/><xsl:param name="chapter_index"/><xsl:param name="page_url"/><xsl:choose><xsl:when test="contains($toc_target, '|clause|')"><xsl:for-each select="clause"><xsl:variable name="_clause_index"><xsl:if test="string-length($chapter_index) &gt; 0"><xsl:value-of select="$chapter_index"/><xsl:number level="multiple" count="clause" format="{$book:clause_index_format}"/></xsl:if></xsl:variable><xsl:variable name="_clause_id"><xsl:call-template name="book:get_id"/></xsl:variable><div class="toc-clause"><xsl:call-template name="book:write_toc_of_clause"><xsl:with-param name="data_url" select="$data_url"/><xsl:with-param name="page_url" select="$page_url"/><xsl:with-param name="chapter_type" select="$chapter_type"/><xsl:with-param name="clause_id" select="$_clause_id"/><xsl:with-param name="clause_index" select="$_clause_index"/></xsl:call-template><xsl:call-template name="book:control_toc_of_section"><xsl:with-param name="data_url" select="$data_url"/><xsl:with-param name="toc_target" select="$toc_target"/><xsl:with-param name="chapter_type" select="$chapter_type"/><xsl:with-param name="chapter_index" select="$chapter_index"/><xsl:with-param name="page_url" select="$page_url"/></xsl:call-template></div></xsl:for-each></xsl:when><xsl:when test="contains($toc_target, '|~clause|')"><xsl:for-each select="clause"><xsl:call-template name="book:control_toc_of_section"><xsl:with-param name="data_url" select="$data_url"/><xsl:with-param name="toc_target" select="$toc_target"/><xsl:with-param name="chapter_type" select="$chapter_type"/><xsl:with-param name="chapter_index" select="$chapter_index"/><xsl:with-param name="page_url" select="$page_url"/></xsl:call-template></xsl:for-each></xsl:when></xsl:choose></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" name="book:write_toc_of_section"><xsl:param name="data_url"/><xsl:param name="page_url"/><xsl:param name="chapter_type"/><xsl:param name="section_id"/><xsl:param name="section_index"/><a class="title"><xsl:attribute name="href"><xsl:value-of select="concat($page_url, '#', $section_id)"/></xsl:attribute><span class="index index-in-{$chapter_type}"><xsl:value-of select="$section_index"/></span><span class="label"><xsl:apply-templates select="title"><xsl:with-param name="data_url" select="$data_url"/></xsl:apply-templates></span></a></xsl:template><xsl:template xmlns:book="https://github.com/sttk/xslet/2019/xslbook" name="book:control_toc_of_section"><xsl:param name="data_url"/><xsl:param name="toc_target"/><xsl:param name="chapter_type"/><xsl:param name="chapter_index"/><xsl:param name="page_url"/><xsl:if test="contains($toc_target, '|section|')"><xsl:for-each select="section"><xsl:variable name="_section_index"><xsl:if test="string-length($chapter_index) &gt; 0"><xsl:value-of select="$chapter_index"/><xsl:number level="multiple" count="clause" format="{$book:clause_index_format}"/><xsl:number level="multiple" count="section" format="{$book:section_index_format}"/></xsl:if></xsl:variable><xsl:variable name="_section_id"><xsl:call-template name="book:get_id"/></xsl:variable><div class="toc-section"><xsl:call-template name="book:write_toc_of_section"><xsl:with-param name="data_url" select="$data_url"/><xsl:with-param name="page_url" select="$page_url"/><xsl:with-param name="chapter_type" select="$chapter_type"/><xsl:with-param name="section_id" select="$_section_id"/><xsl:with-param name="section_index" select="$_section_index"/></xsl:call-template><xsl:call-template name="book:control_toc_of_section"><xsl:with-param name="data_url" select="$data_url"/><xsl:with-param name="toc_target" select="$toc_target"/><xsl:with-param name="chapter_type" select="$chapter_type"/><xsl:with-param name="chapter_index" select="$chapter_index"/><xsl:with-param name="page_url" select="$page_url"/></xsl:call-template></div></xsl:for-each></xsl:if></xsl:template><xsl:template xmlns:util="https://github.com/sttk/xslet/2019/util" name="util:get_dir_from_url"><xsl:param name="url"/><xsl:choose><xsl:when test="not(contains($url, '/'))">.</xsl:when><xsl:otherwise><xsl:call-template name="util:_get_dir_from_url_r"><xsl:with-param name="url" select="$url"/></xsl:call-template></xsl:otherwise></xsl:choose></xsl:template><xsl:template xmlns:util="https://github.com/sttk/xslet/2019/util" name="util:_get_dir_from_url_r"><xsl:param name="url"/><xsl:value-of select="substring-before($url, '/')"/><xsl:variable name="suburl" select="substring-after($url, '/')"/><xsl:if test="string-length($suburl) &gt; 0"><xsl:variable name="subdir"><xsl:call-template name="util:_get_dir_from_url_r"><xsl:with-param name="url" select="$suburl"/></xsl:call-template></xsl:variable><xsl:if test="string-length($subdir) &gt; 0"><xsl:value-of select="concat('/', $subdir)"/></xsl:if></xsl:if></xsl:template><xsl:template xmlns:util="https://github.com/sttk/xslet/2019/util" name="util:get_xsl_url"><xsl:param name="pi" select="/processing-instruction('xml-stylesheet')"/><xsl:variable name="QUOT">"</xsl:variable><xsl:variable name="APOS">'</xsl:variable><xsl:variable name="s1" select="substring-after($pi, 'href')"/><xsl:if test="normalize-space(substring-before($s1, '=')) = ''"><xsl:variable name="s2" select="substring-after($s1, '=')"/><xsl:choose><xsl:when test="substring($s2, 1, 1) = $QUOT"><xsl:value-of select="translate(substring-before(substring-after($s2, $QUOT), $QUOT), '\', '/')"/></xsl:when><xsl:when test="substring($s2, 1, 1) = $APOS"><xsl:value-of select="translate(substring-before(substring-after($s2, $APOS), $APOS), '\', '/')"/></xsl:when><xsl:otherwise><xsl:variable name="s3" select="normalize-space($s2)"/><xsl:choose><xsl:when test="substring($s3, 1, 1) = $QUOT"><xsl:value-of select="translate(substring-before(substring-after($s2, $QUOT), $QUOT), '\', '/')"/></xsl:when><xsl:when test="substring($s3, 1, 1) = $APOS"><xsl:value-of select="translate(substring-before(substring-after($s2, $APOS), $APOS), '\', '/')"/></xsl:when></xsl:choose></xsl:otherwise></xsl:choose></xsl:if></xsl:template><xsl:template xmlns:util="https://github.com/sttk/xslet/2019/util" name="util:validate_string"><xsl:param name="value"/><xsl:param name="forbidden"/><xsl:param name="default"/><xsl:variable name="_s" select="translate($value, $forbidden, '')"/><xsl:choose><xsl:when test="string-length($_s) = string-length($value)"><xsl:value-of select="$value"/></xsl:when><xsl:otherwise><xsl:value-of select="$default"/></xsl:otherwise></xsl:choose></xsl:template></xsl:stylesheet>